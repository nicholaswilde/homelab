version: 2

project_name: "{{ .Env.PROJECT_NAME }}"

builds:
  - id: my-build      # <--- CHANGED: Static ID to prevent path errors
    main: "{{ .Env.MAIN_PATH }}"
    binary: "{{ .Env.PROJECT_NAME }}" # <--- KEEP: The actual file will still be named 'restic'
    env:
      - CGO_ENABLED=0
    goos:
      - linux
    goarch:
      - amd64
      - arm
      - arm64
    goarm:
      - 6
      - 7

nfpms:
  - id: my-build      # <--- CHANGED: Must match the build ID above
    package_name: "{{ .Env.PROJECT_NAME }}" # <--- KEEP: The .deb will be named 'restic_...'
    formats:
      - deb
    maintainer: "Homelab Admin <admin@local>"
    description: "Custom build of {{ .Env.PROJECT_NAME }}"
    bindir: /usr/bin

checksum:
  name_template: 'checksums.txt'

snapshot:
  version_template: "{{ if .Env.VERSION_TAG }}{{ .Env.VERSION_TAG }}{{ else }}SNAPSHOT{{ end }}"
