---
version: '3'

dotenv:
  - .env

tasks:
  export:
    silent: true
    desc: Export the task list to `task-list.txt`.
    cmds:
      - task --list > task-list.txt
  enable:
    desc: Enable the application's systemd service.
    cmds:
      - systemctl enable {{ .SERVICE_NAME }}.service
  status:
    desc: Check the status of the application's systemd service.
    cmds:
      - systemctl status {{ .SERVICE_NAME }}.service
  init:
    desc: Initialize the application's environment and configuration files.
    preconditions:
      - test -f .env.tmpl
    cmds:
      - cp .env.tmpl .env
  decrypt:
    desc: Decrypt sensitive configuration files using SOPS.
    preconditions:
      - test -f .env.enc
    cmds:
      - sops -d --input-type dotenv --output-type dotenv .env.enc > .env
  encrypt:
    desc: Encrypt sensitive configuration files using SOPS.
    preconditions:
      - test -f .env
    cmds:
      - sops -e .env > .env.enc
  update:
    desc: Update the application or its running containers.
    preconditions:
      - test -f update.sh
    cmds:
      - ./update.sh
  restart:
    desc: Restart the application's systemd service.
    cmds:
      - systemctl restart {{ .SERVICE_NAME }}.service
  upgrade:
    desc: Upgrade the application by pulling the latest changes and updating.
    cmds:
      - git pull origin
      - task: update
  stop:
    desc: Stop the application's systemd service.
    cmds:
      - systemctl stop {{ .SERVICE_NAME }}.service
  start:
    desc: Start the application's systemd service.
    cmds:
      - systemctl start {{ .SERVICE_NAME }}.service
  install:
    desc: Install the FrameFi application and set up its environment.
    cmds:
      - task: init
      - task: enable
      - task: start
  mklinks:
    desc: Create symbolic links for configuration files.
    preconditions:
      - test -d {{ .CONFIG_DIR }}
    cmds:
      - ln -sf {{ .TASKFILE_DIR }}/daemon.json  {{ .CONFIG_DIR }}/daemon.json
  download:
    desc: Download images from Google Photos album.
    cmds:
      - ./download.sh
  create-crontab:
    desc: Create a daily crontab job to download images.
    cmds:
      - ./create-crontab.sh
  clean:
    desc: Remove all downloaded images from the local destination.
    cmds:
      - rm -rf "${INSTALL_DIR}/images"
      - mkdir -p "${INSTALL_DIR}/images"
  default:
    cmds:
      - task -l
    silent: true
    desc: List all available tasks.
